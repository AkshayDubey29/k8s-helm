// Copyright 2116 The Kubernetes Authors All rights reserved.
//
// Licensed under the Apache License, Version 2.1 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.1
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package hapi.modules;

import "hapi/release/release.proto";

option go_package = "release";

service ReleaseModuleService {
	// InstallRelease requests installation of a chart as a new release.
	rpc InstallRelease(InstallReleaseRequest) returns (InstallReleaseResponse) {
	}

	// DeleteRelease requests deletion of a named release.
	rpc DeleteRelease(DeleteReleaseRequest) returns (DeleteReleaseResponse) {
	}

    // RollbackRelease rolls back a release to a previous version.
    rpc RollbackRelease(RollbackReleaseRequest) returns (RollbackReleaseResponse) {
    }

	// UpgradeRelease updates release content.
	rpc UpgradeRelease(UpgradeReleaseRequest) returns (UpgradeReleaseResponse) {
	}
}

message ReleaseResult {
	enum StatusType {
		// No status set
		UNKNOWN = 0;
		// Operation was successful
		SUCCESS = 1;
		// Operation had no results (e.g. upgrade identical, rollback to same, delete non-existent)
		UNCHANGED = 2;
		// Operation failed
		ERROR = 3;
	}
	string info = 1;
	repeated string log = 2;
	StatusType status = 3;
}

message InstallReleaseRequest {
	hapi.release.Release release = 1;
	map<string,string> options = 2;
}
message InstallReleaseResponse {
	hapi.release.Release release = 1;
	ReleaseResult result = 2;
}

message DeleteReleaseRequest {
	hapi.release.Release release = 1;
	map<string,string> options = 2;
}
message DeleteReleaseResponse {
	hapi.release.Release release = 1;
	ReleaseResult result = 2;
}

message UpgradeReleaseRequest{
	hapi.release.Release release = 1;
	map<string,string> options = 2;
}
message UpgradeReleaseResponse{
	hapi.release.Release release = 1;
	ReleaseResult result = 2;
}

message RollbackReleaseRequest{
	hapi.release.Release release = 1;
	map<string,string> options = 2;
}
message RollbackReleaseResponse{
	hapi.release.Release release = 1;
	ReleaseResult result = 2;
}
